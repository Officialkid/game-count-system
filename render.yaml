# ===========================================
# Render Blueprint Configuration
# Game Count System Deployment
# ===========================================
#
# This file defines the infrastructure for deploying
# the Game Count System to Render.com
#
# Features:
# - Web service for Next.js API routes
# - Firebase Firestore database
# - Environment variables
# - Health checks
# - Auto-deploy from Git
# - Cron jobs for event cleanup
#
# Deployment: Push this file to your repository root
# Render will auto-detect and offer to create the service
# ===========================================

services:
  # ===========================================
  # Backend Web Service
  # ===========================================
  - type: web
    name: game-count-system
    runtime: node
    region: oregon
    plan: starter  # Free tier: https://render.com/pricing
    
    # Build Configuration
    buildCommand: npm install && npm run build
    startCommand: npm run start
    
    # Auto-deploy settings
    branch: main
    autoDeploy: true
    
    # Health Check
    healthCheckPath: /api/health
    
    # Environment Variables
    envVars:
      # Node Environment
      - key: NODE_ENV
        value: production
      
      # Firebase Client (Public - safe to commit)
      - key: NEXT_PUBLIC_FIREBASE_API_KEY
        value: AIzaSyAUObWvml4MjQeAEpsO-q538IQAxaudNUs
      
      - key: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
        value: combinedactivities-7da43.firebaseapp.com
      
      - key: NEXT_PUBLIC_FIREBASE_PROJECT_ID
        value: combinedactivities-7da43
      
      - key: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
        value: combinedactivities-7da43.firebasestorage.app
      
      - key: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
        value: "254442652269"
      
      - key: NEXT_PUBLIC_FIREBASE_APP_ID
        value: 1:254442652269:web:1c429a4870a217482af564
      
      - key: NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID
        value: G-42DJ5R210S
      
      # Firebase Admin (Private - set manually in dashboard)
      - key: FIREBASE_SERVICE_ACCOUNT_KEY
        sync: false  # Set manually in Render Dashboard - use output from scripts/generate-firebase-env.js
      
      # URLs
      - key: NEXT_PUBLIC_BASE_URL
        sync: false  # Set to your production URL: https://game-count-system.onrender.com
      
      - key: NEXT_PUBLIC_APP_URL
        sync: false  # Set to your production URL: https://game-count-system.onrender.com
      
      - key: NEXT_PUBLIC_API_BASE_URL
        sync: false  # Set to your production URL: https://game-count-system.onrender.com
      
      # Security
      - key: CRON_SECRET
        generateValue: true  # Auto-generate secure random value
      
      # Application URL (auto-generated by Render)
      - key: NEXT_PUBLIC_APP_URL
        sync: false  # Set to your Render service URL: https://gamescore-backend.onrender.com
      
      # Security
      - key: CRON_SECRET
        generateValue: true  # Auto-generate secure random value

# ===========================================
# Cron Jobs (For Event Cleanup)
# ===========================================
# Note: Render's native cron jobs are only available on paid plans
# Alternative: Use external cron services like cron-job.org or EasyCron
# pointing to: https://your-service.onrender.com/api/cron/cleanup-events
# with Authorization header: Bearer $CRON_SECRET

# ===========================================
# Manual Steps After Deployment
# ===========================================
#
# 1. Get Firebase Service Account Key:
#    - Run: node scripts/generate-firebase-env.js
#    - Copy the output JSON string
#
# 2. Set Required Environment Variables in Render Dashboard:
#    - FIREBASE_SERVICE_ACCOUNT_KEY = (paste JSON from step 1)
#    - NEXT_PUBLIC_BASE_URL = https://game-count-system.onrender.com
#    - NEXT_PUBLIC_APP_URL = https://game-count-system.onrender.com
#    - NEXT_PUBLIC_API_BASE_URL = https://game-count-system.onrender.com
#    - CRON_SECRET = (auto-generated or use your own)
#
# 3. Deploy and Test:
#    - Deploy the service
#    - Test: curl https://game-count-system.onrender.com/api/health
#    - Test Firebase: Create an event via API
#
# 4. Setup Cron Job for Event Cleanup (Optional - Free tier):
#    - Use external service like cron-job.org
#    - URL: https://game-count-system.onrender.com/api/cron/cleanup-events
#    - Method: GET
#    - Header: Authorization: Bearer YOUR_CRON_SECRET
#    - Schedule: Every hour (0 * * * *)
#
# 5. Verify Firestore Connection:
#    - Check Firestore Console: https://console.firebase.google.com
#    - Project: combinedactivities-7da43
#    - Verify events are being created
#
# ===========================================
