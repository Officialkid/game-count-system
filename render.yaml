# ===========================================
# Render Blueprint Configuration
# GameScore Backend Deployment
# ===========================================
#
# This file defines the infrastructure for deploying
# the GameScore backend to Render.com
#
# Features:
# - Web service for Next.js API routes
# - PostgreSQL database connection
# - Environment variables
# - Health checks
# - Auto-deploy from Git
#
# Deployment: Push this file to your repository root
# Render will auto-detect and offer to create the service
# ===========================================

services:
  # ===========================================
  # Backend Web Service
  # ===========================================
  - type: web
    name: gamescore-backend
    runtime: node
    region: oregon  # Match your PostgreSQL region
    plan: starter  # Free tier: https://render.com/pricing
    
    # Build Configuration
    buildCommand: npm install && npm run build
    startCommand: npm run start
    
    # Auto-deploy settings
    branch: main
    autoDeploy: true
    
    # Health Check
    healthCheckPath: /api/health
    
    # Environment Variables
    envVars:
      # Node Environment
      - key: NODE_ENV
        value: production
      
      # Database URLs (from Render PostgreSQL service)
      # NOTE: Set these manually in Render Dashboard or use sync: true
      - key: DATABASE_URL
        sync: false  # Set manually - use Internal Database URL
      
      - key: POSTGRES_URL
        sync: false  # Set manually - use Internal Database URL
      
      # Application URL (auto-generated by Render)
      - key: NEXT_PUBLIC_APP_URL
        sync: false  # Set to your Render service URL: https://gamescore-backend.onrender.com
      
      # Cron Security Secret
      - key: CRON_SECRET
        generateValue: true  # Auto-generate secure random value

# ===========================================
# Manual Steps After Deployment
# ===========================================
#
# 1. Get PostgreSQL Internal URL:
#    - Go to Render Dashboard > Databases > Your PostgreSQL
#    - Copy "Internal Database URL" (faster, free within Render network)
#
# 2. Set Environment Variables in Render:
#    - DATABASE_URL = [Internal Database URL]
#    - POSTGRES_URL = [Internal Database URL]
#    - NEXT_PUBLIC_APP_URL = https://your-service.onrender.com
#    - CRON_SECRET = (auto-generated)
#
# 3. Test Deployment:
#    curl https://your-service.onrender.com/api/health
#
# 4. Configure Cron Job (Optional):
#    - Render Dashboard > Cron Jobs > New Cron Job
#    - Command: curl -X POST https://your-service.onrender.com/api/cron/cleanup -H "Authorization: Bearer $CRON_SECRET"
#    - Schedule: 0 2 * * * (Daily at 2 AM UTC)
#
# ===========================================
